interface ModuleFragmentConfiguration : DependencyContainer {
    val delegatedModuleFragment: ModuleFragment

    override val dependencies: MutableList<Dependency>
        get() = delegatedModuleFragment.dependencies

    fun includes(fragment: ModuleFragment): Unit =
        delegatedModuleFragment.includes(fragment)

    fun supplementary(name: String, body: ModuleFragment.() -> Unit): Unit {
        delegatedModuleFragment.supplementaries.add(ModuleFragment(delegatedModuleFragment.module).also(body))
    }
}

class ModuleFragment(val module: Module) : DependencyContainer, ModuleFragmentConfiguration {
    override val delegatedModuleFragment: ModuleFragment
        get() = error("")

    val supplementaries = mutableListOf<ModuleFragment>()

    override val dependencies = mutableListOf<Dependency>()

    val includes = mutableListOf<ModuleFragment>()

    override fun includes(fragment: ModuleFragment) {
        includes.add(fragment)
    }

    operator fun SupplementaryKind.invoke(body: ModuleFragmentConfiguration.() -> Unit) {
        supplementary(name, body)
    }
}