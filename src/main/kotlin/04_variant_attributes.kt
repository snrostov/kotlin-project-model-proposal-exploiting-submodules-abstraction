import kotlin.properties.ReadWriteProperty
import kotlin.reflect.KProperty

/**
 * Example:
 *
 * ```
 *     enum class Platform {
 *         jvm, js, native;
 *         companion object: VariantAttribute<Platform>
 *     }
 *
 *     val VariantAttributeValues.platform by Platform
 * ```
 */
interface VariantAttribute<V: Any>: ReadWriteProperty<VariantAttributeValues, V> {
    override fun getValue(thisRef: VariantAttributeValues, property: KProperty<*>): V  = thisRef[this]

    override fun setValue(thisRef: VariantAttributeValues, property: KProperty<*>, value: V) {
        thisRef[this] = value
    }
}

class VariantAttributeValues {
    private val values = mutableMapOf<VariantAttribute<*>, Any?>()

    operator fun contains(attribute: VariantAttribute<*>): Boolean = attribute in values

    operator fun <V: Any> set(attribute: VariantAttribute<V>, value: V) {
        values[attribute] = value
    }

    operator fun <V: Any> get(attribute: VariantAttribute<V>): V {
        return values[attribute] as V
    }
}
