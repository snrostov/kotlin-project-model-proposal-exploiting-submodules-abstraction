package hl

import ll.LLModule
import java.io.File

class Module {
    val module = LLModule()

    val children = mutableListOf<Module>()
    val dirs = mutableListOf<File>()
    val helpers = mutableListOf<Module>()
    val rootRefinement = Refinement(this, null)

    fun module(body: Module.() -> Unit) = Module().also {
        children.add(it)
        rootRefinement.dependsOn(it)
        body(it)
    }

    fun inline(dir: File) {
        dirs.add(dir)
    }

    fun helper(body: Module.() -> Unit) = Module().also {
        helpers.add(it)
        it.rootRefinement.dependsOn(this)
        body(it)
    }

    fun refinement(body: Refinement.() -> Unit) = rootRefinement.refinement(body)

    fun variant(body: Refinement.() -> Unit) = rootRefinement.variant(body)
}