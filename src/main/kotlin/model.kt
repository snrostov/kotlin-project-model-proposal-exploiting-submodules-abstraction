sealed class VariantQualifier
object XZ: VariantQualifier()
object JVM: VariantQualifier()
object JS: VariantQualifier()
object Native: VariantQualifier()

interface DependencyAware {
    val dependencies: MutableList<Dependency>
}

class DependencyBuilder(
    val dependencies: MutableList<Dependency>
) {
    fun api(module: Module) =
        dependencies.add(Dependency(module.id))
}

class Module(val id: String): DependencyAware {
    val common = ModuleVariant(this, XZ)

    val variants = mutableListOf<ModuleVariant>(common)

    override val dependencies: MutableList<Dependency> get() = common.dependencies
}

class ModuleVariant(val module: Module, val qualifier: VariantQualifier): DependencyAware {
    lateinit var artficat: Artifact
    override val dependencies = mutableListOf<Dependency>()
}

class Dependency(
    val targetId: String,
    val qualifier: VariantQualifier
)

fun module(id: String, body: Module.() -> Unit) = Module(id).also(body)

fun Module.variant(qualifier: VariantQualifier? = null, body: ModuleVariant.() -> Unit) =
    ModuleVariant(this, qualifier).also(body)

fun DependencyAware.dependencies(body: DependencyBuilder.() -> Unit) {
    body(DependencyBuilder(dependencies))
}

fun simpleJvmProject() {
    module("myProject") {
        dependencies {
            // something here...
        }
    }
}

fun kotlinxCorutinesProject() {
    val kotlinxCorutinesCore = module("kotlinx-corutines-core") {
        dependencies {
            // common dependencies
        } // same as `common.dependencies {  }`

        variant(JVM) {
            dependencies {
                // jvm only dependencies
                api(common)
            }
        }
        variant(Native) {
            dependencies {
                api(common)
            }
        }
        variant(JS) {
            dependencies {
                api(common)
            }
        }
    }

    val kotlinxCorutinesCoreTest = module("kotlinx-corutines-core-test") {
        dependencies {
            api(kotlinxCorutinesCore)
        }

        variant(JVM) {
            dependencies {
                // jvm only dependencies
                api(common)
            }
        }

        variant(Native) {
            dependencies {
                api(common)
            }
        }

        variant(JS) {
            dependencies {
                api(common)
            }
        }
    }

    module("kotlinx-corutines-ui") {
        dependencies {
            // common dependencies
            api(kotlinxCorutinesCore)
        }

        variant(JVM) {
            dependencies {
                // jvm only dependencies
            }
        }
        variant(Native) {}
        variant(JS) {}
    }
}

fun hmppProject() {
    module("hmpp") {
        val jvmJs = variant {
            dependencies {
                api(common)
            }
        }

        val jvmNative = variant {
            dependencies {
                api(common)
            }
        }

        variant(JVM) {
            dependencies {
                api(jvmJs)
                api(jvmNative)
            }
        }

        variant(Native) {
            dependencies {
                api(jvmJs)
            }
        }

        variant(JS) {
            dependencies {
                api(jvmNative)
            }
        }
    }
}